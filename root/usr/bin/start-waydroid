#!/bin/bash

# Start Waydroid Container Service if not running
if [ ! -S /run/waydroid/waydroid.socket ] && [ ! -S /var/lib/waydroid/waydroid.socket ]; then
    echo "Starting Waydroid Container Service..."
    # Check if we are root, if not try sudo
    if [ "$(id -u)" -eq 0 ]; then
        waydroid container start > /var/log/waydroid-container.log 2>&1 &
    else
        sudo waydroid container start > /tmp/waydroid-container.log 2>&1 &
    fi
    
    # Wait for service to be ready
    echo "Waiting for Waydroid Container Service..."
    count=0
    while [ ! -S /run/waydroid/waydroid.socket ] && [ ! -S /var/lib/waydroid/waydroid.socket ]; do
        sleep 1
        count=$((count+1))
        if [ $count -ge 30 ]; then
            echo "Timeout waiting for Waydroid Container Service"
            # It might still work if the socket path is different, but let's warn
            break
        fi
    done
fi

echo "Starting Waydroid session..."
# Using show-full-ui to launch the app window
waydroid show-full-ui
